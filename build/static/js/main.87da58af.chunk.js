(this["webpackJsonpco-creatures"]=this["webpackJsonpco-creatures"]||[]).push([[0],{176:function(e,t,a){e.exports=a(306)},181:function(e,t,a){},304:function(e,t,a){},306:function(e,t,a){"use strict";a.r(t);var r=a(0),i=a.n(r),n=a(39),s=a.n(n),l=(a(181),a(29)),c=a(30),o=a(32),u=a(31),h=a(320),p=a(316),d=a(321),m=a(317),f=a(97),g=a.n(f),v=a(144);function b(e){return x.apply(this,arguments)}function x(){return(x=Object(v.a)(g.a.mark((function e(t){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"GET",redirect:"follow",headers:new Headers({key:"ylPI5rutd4MESz4l"})},e.abrupt("return",fetch(t,a).then((function(e){return e.json()})).then((function(e){return localStorage.setItem(t,JSON.stringify(e)),e}),(function(e){console.log(e)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this,e)).state={error:null,isLoaded:!1,items:[],filter:""},r}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;b("https://co-api.gimond.fr/api/v1/creatures").then((function(t){e.setState({isLoaded:!0,items:t})}))}},{key:"handleFilterInputChange",value:function(e){this.setState({filter:e.target.value})}},{key:"handleCreatureClick",value:function(e){e.preventDefault(),"function"===typeof this.props.setCreature&&this.props.setCreature(e.currentTarget.getAttribute("data-id"))}},{key:"render",value:function(){var e=this,t=this.state,a=t.error,r=t.isLoaded,n=t.items;if(a)return i.a.createElement("div",null,"Erreur : ",a.message);var s="";return s=r?n.filter((function(t){return""===e.state.filter||t.nom.toLowerCase().includes(e.state.filter.toLowerCase())})).map((function(t){return i.a.createElement(h.a.Row,{key:t.id,onClick:e.handleCreatureClick.bind(e),"data-id":t.id,active:e.props.creature&&e.props.creature.id===t.id},i.a.createElement(h.a.Cell,null,t.nc),i.a.createElement(h.a.Cell,null,i.a.createElement(d.a,{as:"h4"},i.a.createElement(d.a.Content,null,t.nom,i.a.createElement(d.a.Subheader,null,t.milieu_naturel)))))})):i.a.createElement(h.a.Row,null,i.a.createElement(h.a.Cell,{colSpan:"2"},i.a.createElement(p.a,{inverted:!0}))),i.a.createElement("div",null,i.a.createElement(m.a,{icon:"search",placeholder:"Rechercher...",value:this.state.filter,type:"text",onChange:this.handleFilterInputChange.bind(this)}),i.a.createElement(p.a,{inverted:!0}),i.a.createElement(h.a,{basic:"very",celled:!0,collapsing:!0,selectable:!0},i.a.createElement(h.a.Header,null,i.a.createElement(h.a.Row,null,i.a.createElement(h.a.HeaderCell,{width:2},"NC"),i.a.createElement(h.a.HeaderCell,null,"Nom"))),i.a.createElement(h.a.Body,null,s)))}}]),a}(r.Component),E=a(163),k=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this,e)).state={error:null,isLoaded:!1},r.canvasRef=i.a.createRef(),r.backgroundImgRef=i.a.createRef(),r.templates={modern:{width:360,height:600,padding:20,smallSize:10,caracSize:20,textSize:14,titleSize:14,baseColor:"#08091f",accentColor:"#df4a4a"},classic:{width:360,height:600,padding:20,smallSize:10,caracSize:20,textSize:14,titleSize:14,baseColor:"#08091f",accentColor:"#df4a4a"}},r.template=r.templates[r.props.template],r.template.name=r.props.template,r}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.ctx=this.canvasRef.current.getContext("2d"),this.backgroundImgRef.current.onload=function(){e.ctx.drawImage(e.backgroundImgRef.current,0,0)}}},{key:"render",value:function(){if(this.props.creature){console.log(this.props.creature);var e=this.props.creature,t=this.template.padding;this.ctx.drawImage(this.backgroundImgRef.current,0,0),t=this.wrapText(e.nom,this.template.padding,t,22,22,this.template.width-2*this.template.padding-120),t+=25;var a=[];e.nc&&a.push("NC "+e.nc),e.categorie&&a.push("cr\xe9ature "+e.categorie.toLowerCase()),e.taille&&a.push("taille "+e.taille.toLowerCase()),e.rang_de_boss&&a.push("Boss rang "+e.rang_de_boss),this.ctx.font=this.template.smallSize+"px NexusSansOT",this.ctx.textAlign="left",t=this.wrapText(a.join(", "),this.template.padding,t,this.template.smallSize,1.3*this.template.smallSize,this.template.width-2*this.template.padding-120),this.displayCarac("DEF",e.DEF?e.DEF:"-",this.template.width-120,this.template.padding-5,"white","white"),this.displayCarac("PV",e.PV?e.PV:"-",this.template.width-75,this.template.padding-5,"white","white"),this.displayCarac("Init",e.init?e.init:"-",this.template.width-30,this.template.padding-5,"white","white");var r=1;for(var n in t+=35,e.caracteristiques){var s=t,l=this.template.width/7*r,c=e.caracteristiques[n];(c=parseInt(c))>=0&&(c="+"+c),this.displayCarac(" "+n+(-1!==e.caracteristiques_superieures.indexOf(n)?" *":" "),c,l,s),r++}if(t+=20,e.attaques)for(var o in t+=35,this.displayTitle("Attaques",this.template.padding,t),e.attaques)o&&(t+=20,t=this.wrapText(e.attaques[o],this.template.padding,t,this.template.textSize,20));if(e.capacites_speciales){t+=30,this.displayTitle("Capacit\xe9s",this.template.padding,t),t+=20;var u=e.capacites_speciales.split(/\r?\n/);for(var h in console.log(u),u)h.length&&(t=this.wrapText(h,this.template.padding,t,this.template.textSize,20))}}return i.a.createElement("div",null,i.a.createElement("canvas",{ref:this.canvasRef,width:this.template.width,height:this.template.height}),i.a.createElement("img",{ref:this.backgroundImgRef,src:"images/background_"+this.template.name+".jpg",alt:"",hidden:!0}),i.a.createElement("footer",{className:"colophon"},i.a.createElement("a",{href:"https://www.freepik.com/free-photos-vectors/background"},"Background photo created by aopsan - www.freepik.com"),i.a.createElement("a",{href:"https://game-icons.net/1x1/caro-asercion/goblin.html"},"Goblin icon by Caro Asercion")))}},{key:"displayTitle",value:function(e,t,a){this.ctx.save(),this.ctx.font="bold "+this.template.titleSize+"px NexusSansOT",this.ctx.textAlign="left",this.ctx.fillStyle=this.template.accentColor,e=this.letterSpace(e.toUpperCase()),this.ctx.fillText(e,t,a),this.ctx.restore()}},{key:"displayCarac",value:function(e,t,a,r,i,n){return i||(i=this.template.accentColor),n||(n=this.template.baseColor),this.ctx.save(),this.ctx.font="bold "+this.template.smallSize+"px NexusSansOT",this.ctx.textAlign="center",this.ctx.fillStyle=i,e=this.letterSpace(e.toUpperCase()),this.ctx.fillText(e,a,r),this.ctx.font=this.template.caracSize+"px NexusSansOT",this.ctx.fillStyle=n,this.ctx.fillText(t,a,r+12),this.ctx.restore(),r+12}},{key:"letterSpace",value:function(e){return e=e.split("").join(String.fromCharCode(8202))}},{key:"wrapText",value:function(e,t,a,r,i,n){e=e.replace(/(<([^>]+)>)/gi,""),n||(n=this.template.width-2*this.template.padding);var s=e.split(" "),l="";i||(i=1.286*r),this.ctx.font=r+"px NexusSansOT",this.ctx.textBaseline="top";for(var c=0;c<s.length;c++){var o=l+s[c]+" ";this.ctx.measureText(o).width>n?(this.ctx.fillText(l,t,a),l=s[c]+" ",a+=i):l=o}return this.ctx.fillText(l,t,a),a}},{key:"saveImg",value:function(){this.canvasRef.current.toDataURL()}},{key:"Dropzone",value:function(){var e=Object(r.useCallback)((function(e){console.log(e)}),[]),t=Object(E.a)({onDrop:e}),a=t.getRootProps,n=t.getInputProps,s=t.isDragActive;return i.a.createElement("div",a(),i.a.createElement("input",n()),s?i.a.createElement("p",null,"Drop the files here ..."):i.a.createElement("p",null,"Drag 'n' drop some files here, or click to select files"))}}]),a}(r.Component),S=a(73),w=a(319),y=a(318),N=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this,e)).state={statblock:"Mandefer - Cuirasse du dragon\nBoss rang 4\nNC 8\nFOR +4* DEX +0 CON +3\nINT +2 SAG +0 CHA +0\nDEF 25 PV 125 Init 10\nHache (2 attaque) +14 DM 2d6+13"},r.handleStatBlockChange=r.handleStatBlockChange.bind(Object(S.a)(r)),r}return Object(c.a)(a,[{key:"render",value:function(){return i.a.createElement(w.a,null,i.a.createElement(y.a,{value:this.state.statblock,onChange:this.handleStatBlockChange.bind(this)}))}},{key:"buildRegexp",value:function(e){var t="\\b(",a=!0;for(var r in e)a?(t+=r,a=!1):t+="|"+r;return t+="|cr\xe9ature)\\b",new RegExp(t,"gi")}},{key:"handleStatBlockChange",value:function(e){var t=e.target.value;this.setState({statblock:t});var a=this.parseStatBlock(t);"function"===typeof this.props.setCreatureFromStatBlock&&this.props.setCreatureFromStatBlock(a)}},{key:"parseStatBlock",value:function(e){var t=0,a={for:"FOR",dex:"DEX",con:"CON",int:"INT",sag:"SAG",per:"SAG",cha:"CHA",creature:"profil",nc:"nc",niveau:"nc",taille:"taille",profil:"profil",init:"init",def:"DEF",pv:"PV",rd:"RD"},r=this.buildRegexp(a);if(""!==e){var i=e.replace(/\r/g,""),n=(i=(i=(i=i.replace(/\ue1e9/g,"")).replace(/\u2665/g,"")).replace(/\ue0bf/g,"")).split(/\n/),s={},l="",c=!1,o="",u=!0;return n.forEach((function(e){if(""===e)return l="",o="",u=!1,void(c=!1);if((e=e.trim()).endsWith("DM"))l+=e+" ",c=!0;else if(c||e.search(/\bDM\b/i)>=0){var i=l+e,n=i.search(/\s(\+\d+|0\b|DM)/i),h=i.substring(0,n),p=/\(\d+\s*m\)/i.exec(h);p&&(h=h.substring(0,p.index).trim(),p=parseInt(p[0].substring(1)),isNaN(p)&&(p=0));var d=0;if((i=i.substring(n).trim()).startsWith("+")){if(i=i.substring(1),d=parseInt(i),isNaN(d))return console.log("Sheet worker: bonus d'attaque incorrect "+e),void(l="");i=i.substring(i.search(/\D/))}else i.startsWith("0")&&(i=i.substring(1).trim());var m=i.search(/\bDM\b/i),f=i.substring(0,m);(m=(i=i.substring(m+3).trim()).search(/\s/))<0&&(m=i.length);var g=0,v=4,b=0,x=i.substring(0,m),C=x.search(/d/i);if(C<0){if(b=parseInt(x),isNaN(b))return console.log("Impossible de trouver les DM dans "+e),l+=e+" ",void(c=!0)}else{if(g=parseInt(x.substring(0,C)),x=x.substring(C+1),v=parseInt(x),isNaN(b)||isNaN(v))return console.log("Impossible de trouver les DM dans "+e),l+=e+" ",void(c=!0);var E=x.search(/(\+|-)/);E>=0?(b=parseInt(x.substring(E)),isNaN(b)&&(b=0)):m>0&&m<i.length-1&&(i=i.substring(m).trim(),m=0,(i.startsWith("+")||i.startsWith("-"))&&(b=parseInt(i),isNaN(b)?b=0:m=i.search(/\s/)))}m>=0&&m<i.length-1&&(f+=i.substring(m).trim());var k="repeating_pnjatk_"+Math.random()+"_arme";t++,s.attaques||(s.attaques=[]),s.attaques.push(h+" +"+d+" DM "+g+"d"+v+(b?"+"+b:"")+" "+f),o=k,c=!1,l=""}else if(e.startsWith("+")&&""!==o)s[o+"spec"]+=e;else{o="";for(var S,w=[],y=r.exec(e);y;)S&&w.push({match:S,end:y.index}),S=y,y=r.exec(e);S&&w.push({match:S,end:e.length}),0===w.length?u?s.nom=e:(console.log("La ligne "+e+" ne correspond \xe0 rien"),l=e+" "):l="",w.forEach((function(t){var r=t.match[0].toLowerCase(),i=a[r];if(void 0===i&&"cr\xe9ature"===r&&(i=a.creature),void 0!==i){var n=e.substring(t.match.index+r.length,t.end).trim();if(n=n.replace(/\)$/,""),console.log(i),-1!==i.search(/(FOR|DEX|CON|SAG|INT|CHA)/)){n.endsWith("*")&&(n=n.substr(0,n.length-1),s.caracteristiques_superieures||(s.caracteristiques_superieures=[]),s.caracteristiques_superieures.push(i));var l=n.indexOf("/");n=l>0?parseInt(n.substring(l+1)):parseInt(n),s.caracteristiques||(s.caracteristiques=[]),s.caracteristiques[i]=n}else if("pnj_pv_max"===i){var c=parseInt(n),o=n.indexOf("(");if(o>0){var u=parseInt(n.substring(o+1));s.PV=u,n=n.substring(0,o).trim()}else s.PV=c}s[i]=n}else console.log("Erreur ! Pattern "+r+" non reconne. La ligne \xe9tait "+t)}))}u=!1})),s.max_attack_label=t,s}}}]),a}(r.Component),O=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this,e)).state={error:null,isLoaded:!1,creature:null},r}return Object(c.a)(a,[{key:"setCreature",value:function(e){var t=this;b("https://co-api.gimond.fr/api/v1/creatures?id="+e).then((function(e){var a=e[0];t.setState({isLoaded:!0,creature:a})}))}},{key:"setCreatureFromStatBlock",value:function(e){this.setState({isLoaded:!0,creature:e})}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("header",{className:"App-header"},"Cr\xe9atures"),i.a.createElement("div",{className:"content"},i.a.createElement("div",{className:"col left"},i.a.createElement(N,{setCreatureFromStatBlock:this.setCreatureFromStatBlock.bind(this)}),i.a.createElement(C,{setCreature:this.setCreature.bind(this),creature:this.state.creature})),i.a.createElement("div",{className:"col right"},i.a.createElement(k,{template:"modern",creature:this.state.creature}))))}}]),a}(r.Component);a(304),a(305);var I=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(O,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[176,1,2]]]);
//# sourceMappingURL=main.87da58af.chunk.js.map